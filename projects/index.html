<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目问题 | interview</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="favicon.ico">
    <meta name="description" content="项目问题">
    
    <link rel="preload" href="/interview/assets/css/0.styles.f82613e7.css" as="style"><link rel="preload" href="/interview/assets/js/app.3ba8eaa2.js" as="script"><link rel="preload" href="/interview/assets/js/2.7108d1be.js" as="script"><link rel="preload" href="/interview/assets/js/33.c75eaf5c.js" as="script"><link rel="prefetch" href="/interview/assets/js/10.36c4c4cf.js"><link rel="prefetch" href="/interview/assets/js/11.416b3d0a.js"><link rel="prefetch" href="/interview/assets/js/12.5895cc11.js"><link rel="prefetch" href="/interview/assets/js/13.c01b5bf5.js"><link rel="prefetch" href="/interview/assets/js/14.7cbde388.js"><link rel="prefetch" href="/interview/assets/js/15.64b915ff.js"><link rel="prefetch" href="/interview/assets/js/16.60a21257.js"><link rel="prefetch" href="/interview/assets/js/17.e91268e2.js"><link rel="prefetch" href="/interview/assets/js/18.29c6f974.js"><link rel="prefetch" href="/interview/assets/js/19.3862f48c.js"><link rel="prefetch" href="/interview/assets/js/20.e08088d6.js"><link rel="prefetch" href="/interview/assets/js/21.5cfbe2ff.js"><link rel="prefetch" href="/interview/assets/js/22.c18f3afc.js"><link rel="prefetch" href="/interview/assets/js/23.2d6e18ad.js"><link rel="prefetch" href="/interview/assets/js/24.c5d5d79e.js"><link rel="prefetch" href="/interview/assets/js/25.95dfb178.js"><link rel="prefetch" href="/interview/assets/js/26.eba8bd0f.js"><link rel="prefetch" href="/interview/assets/js/27.80475a88.js"><link rel="prefetch" href="/interview/assets/js/28.f454597d.js"><link rel="prefetch" href="/interview/assets/js/29.77d27e2c.js"><link rel="prefetch" href="/interview/assets/js/3.eefd49c2.js"><link rel="prefetch" href="/interview/assets/js/30.c6974046.js"><link rel="prefetch" href="/interview/assets/js/31.6639d149.js"><link rel="prefetch" href="/interview/assets/js/32.d6e5252c.js"><link rel="prefetch" href="/interview/assets/js/4.48dd99e3.js"><link rel="prefetch" href="/interview/assets/js/5.63ef4739.js"><link rel="prefetch" href="/interview/assets/js/6.2bae28b1.js"><link rel="prefetch" href="/interview/assets/js/7.546c4f43.js"><link rel="prefetch" href="/interview/assets/js/8.1f451005.js"><link rel="prefetch" href="/interview/assets/js/9.71c5f244.js">
    <link rel="stylesheet" href="/interview/assets/css/0.styles.f82613e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview/" class="home-link router-link-active"><!----> <span class="site-name">interview</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/bases/html/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/interview/fe-frameworks/vue2.x/" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/interview/projects/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  项目问题
</a></div><div class="nav-item"><a href="/interview/data-structures-and-algorithms/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/interview/design-patterns/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/interview/good-articles/" class="nav-link">
  好文推荐
</a></div><div class="nav-item"><a href="/interview/practice/empty/" class="nav-link">
  实战真题
</a></div><div class="nav-item"><a href="/interview/learn/" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/interview/knowledge-map/" class="nav-link">
  知识脑图
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/bases/html/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/interview/fe-frameworks/vue2.x/" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/interview/projects/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  项目问题
</a></div><div class="nav-item"><a href="/interview/data-structures-and-algorithms/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/interview/design-patterns/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/interview/good-articles/" class="nav-link">
  好文推荐
</a></div><div class="nav-item"><a href="/interview/practice/empty/" class="nav-link">
  实战真题
</a></div><div class="nav-item"><a href="/interview/learn/" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/interview/knowledge-map/" class="nav-link">
  知识脑图
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/interview/projects/" aria-current="page" class="active sidebar-link">项目问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#项目优化" class="sidebar-link">项目优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#首屏优化" class="sidebar-link">首屏优化</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#开发体验优化" class="sidebar-link">开发体验优化</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#切换test-pre-online环境" class="sidebar-link" style="padding-left:3rem;">切换test pre online环境</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#如何定位性能瓶颈" class="sidebar-link" style="padding-left:3rem;">如何定位性能瓶颈</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#网络" class="sidebar-link" style="padding-left:3rem;">网络</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#webpack" class="sidebar-link" style="padding-left:3rem;">webpack</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#nginx" class="sidebar-link" style="padding-left:3rem;">nginx</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#离线化平台" class="sidebar-link" style="padding-left:3rem;">离线化平台</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/projects/#项目监控" class="sidebar-link">项目监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#错误监控" class="sidebar-link">错误监控</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#埋点监控" class="sidebar-link">埋点监控</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#性能监控" class="sidebar-link">性能监控</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#敏感数据反爬" class="sidebar-link">敏感数据反爬</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/projects/#native-sdk" class="sidebar-link">native-sdk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#h5和nativa通信" class="sidebar-link">h5和nativa通信</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#h5调用native" class="sidebar-link">h5调用native</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#native调用h5" class="sidebar-link">native调用h5</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/projects/#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#抓包" class="sidebar-link">抓包</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#cdn" class="sidebar-link">CDN</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#spa页面-和-多页面对比" class="sidebar-link">spa页面 和 多页面对比</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#解决方案" class="sidebar-link" style="padding-left:3rem;">解决方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview/projects/#项目介绍思路" class="sidebar-link">项目介绍思路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/#思路和角度" class="sidebar-link">思路和角度</a></li><li class="sidebar-sub-header"><a href="/interview/projects/#项目亮点难点" class="sidebar-link">项目亮点难点</a></li></ul></li></ul></li><li><a href="/interview/projects/webpack/" class="sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#webpack" class="sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#webpack-hrm原理" class="sidebar-link">webpack-HRM原理</a></li><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#tree-shaking" class="sidebar-link">Tree-shaking</a></li><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#webpack优化" class="sidebar-link">webpack优化</a></li><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#webpack如何分包" class="sidebar-link">webpack如何分包</a></li><li class="sidebar-sub-header"><a href="/interview/projects/webpack/#玩转webpackppt" class="sidebar-link">玩转webpackppt</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="项目优化"><a href="#项目优化" class="header-anchor">#</a> 项目优化</h2> <h3 id="首屏优化"><a href="#首屏优化" class="header-anchor">#</a> 首屏优化</h3> <ol><li>图片懒加载</li></ol> <h3 id="开发体验优化"><a href="#开发体验优化" class="header-anchor">#</a> 开发体验优化</h3> <h4 id="切换test-pre-online环境"><a href="#切换test-pre-online环境" class="header-anchor">#</a> 切换test pre online环境</h4> <h4 id="如何定位性能瓶颈"><a href="#如何定位性能瓶颈" class="header-anchor">#</a> 如何定位性能瓶颈</h4> <blockquote><p>控制台观察</p></blockquote> <ul><li>观察js css 图片的加载速率</li> <li>performance
<ol><li>看饼状图 看性能瓶颈</li> <li>准备发起请求</li></ol></li></ul> <h4 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h4> <ul><li>DSN(DNS预解析DNS Prefetch)</li> <li>建立TCP连接（减少http请求的量 资源整合） 请求资源 返回资源 渲染domm</li></ul> <h4 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h4> <ul><li><p>基础环境</p> <ol><li>include exclude</li> <li>压缩打包</li> <li>分包处理
<ol><li>懒加载路由</li> <li>splitChunks</li> <li>dll 抽取公用的模块</li></ol></li></ol></li> <li><p>测试环境</p> <ol><li><code>unused-files-webpack-plugin</code> 没有使用到的文件</li> <li><code>webpack-bundle-analyzer</code> 分析包的大小 上传到远端查看</li> <li><code>sw-precache-webpack-plugin</code> 打包速度</li> <li><code>webpack-dev-server</code> 开启热更新</li></ol></li></ul> <h4 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h4> <ul><li>配置里 index.html no-store</li> <li>js css png图片等使用 expires max</li> <li>开启了gzip</li></ul> <h4 id="离线化平台"><a href="#离线化平台" class="header-anchor">#</a> 离线化平台</h4> <ol><li>部署信息
<ol><li>构建时间</li> <li>构建人</li> <li>构建文件</li> <li>提交信息（commitID）分支</li> <li>等等</li></ol></li></ol> <h2 id="项目监控"><a href="#项目监控" class="header-anchor">#</a> 项目监控</h2> <h3 id="错误监控"><a href="#错误监控" class="header-anchor">#</a> 错误监控</h3> <p>[常见的错误拦截]（<a href="https://blog.fundebug.com/2018/12/07/how-to-handle-frontend-error/" target="_blank" rel="noopener noreferrer">https://blog.fundebug.com/2018/12/07/how-to-handle-frontend-error/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <ol><li><p><code>window.onerror()</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">// message：错误信息（字符串）。可用于HTML onerror=&quot;&quot;处理程序中的event。</span>
<span class="token comment">// source：发生错误的脚本URL（字符串）</span>
<span class="token comment">// lineno：发生错误的行号（数字）</span>
<span class="token comment">// colno：发生错误的列号（数字）</span>
<span class="token comment">// error：Error对象（对象） </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>如果想通过onerror函数收集不同域的js错误，我们需要做两件事：
<ul><li>相关的js文件上加上<code>Access-Control-Allow-Origin:*</code>的response header</li> <li>引用相关的js文件时加上crossorigin属性</li></ul></li></ul></li> <li><p><code>unhandledrejection</code> 继承自 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PromiseRejectionEvent" target="_blank" rel="noopener noreferrer"><code>PromiseRejectionEvent</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，而 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PromiseRejectionEvent" target="_blank" rel="noopener noreferrer"><code>PromiseRejectionEvent</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 又继承自 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event" target="_blank" rel="noopener noreferrer"><code>Event</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。因此<code>unhandledrejection</code> 含有 <code>PromiseRejectionEvent</code> 和 <code>Event</code> 的属性和方法。</p> <ul><li>当<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer"><code>Promise</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 被 reject 且没有 reject 处理器的时候，会触发 <strong><code>unhandledrejection</code></strong> 事件；这可能发生在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window" target="_blank" rel="noopener noreferrer"><code>window</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下，但也可能发生在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker" target="_blank" rel="noopener noreferrer"><code>Worker</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中。 这对于调试回退错误处理非常有用。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unhandledrejection&quot;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">UNHANDLED PROMISE REJECTION: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>try catch</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>vue</p></li> <li><p><a href="https://cn.vuejs.org/v2/api/#errorCaptured" target="_blank" rel="noopener noreferrer">errorCaptured<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>钩子</p></li> <li><p>sentry</p> <ul><li><p>对window.onerror和unhandlerejection的重写</p></li> <li><p>跨浏览的兼容</p></li> <li><p><a href="https://segmentfault.com/a/1190000023089675" target="_blank" rel="noopener noreferrer">sentry原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/75577689" target="_blank" rel="noopener noreferrer">源码解析 知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>window.onerror</p> <ul><li>只能捕获运行时错误</li> <li>无法捕获语法错误</li> <li>无法捕获资源加载错误（可使用window.addEventListener('error')  资源加载错误的节点活冒泡到window对象， 并且没法知道错误码）</li></ul></li></ul></li></ol> <h3 id="埋点监控"><a href="#埋点监控" class="header-anchor">#</a> 埋点监控</h3> <p>阅读tracker源码</p> <h3 id="性能监控"><a href="#性能监控" class="header-anchor">#</a> 性能监控</h3> <p>利用<code>window.performance</code>来统计</p> <h3 id="敏感数据反爬"><a href="#敏感数据反爬" class="header-anchor">#</a> 敏感数据反爬</h3> <ol><li>css font
<ul><li>自己生成wotff</li> <li>不同的unicode码对应数字</li> <li>规则给到后端</li> <li>后端对敏感数字返回相对应的unicode</li> <li>前端通过自定义字体解析unicode展示响应的内容</li></ul></li></ol> <h2 id="native-sdk"><a href="#native-sdk" class="header-anchor">#</a> native-sdk</h2> <h3 id="h5和nativa通信"><a href="#h5和nativa通信" class="header-anchor">#</a> h5和nativa通信</h3> <ol><li><p>native在webview的全局<code>window</code>对象下面挂载了一个全局对象<code>webviewJsBridge</code></p></li> <li><p><code>webviewJsBridge</code>中有<code>callHandler</code>和<code>registter</code>方法</p></li> <li><p>h5调用native方法使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>webviewJsBridge<span class="token punctuation">.</span><span class="token function">callHandler</span><span class="token punctuation">(</span>apiName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>三种 js 调用 native 方法</p> <ul><li>拦截 Url Schema（假请求）</li> <li>拦截 prompt alert confirm</li> <li>注入 JS 上下文</li></ul></li> <li><p>native调用js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>webviewJsBridge<span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span>apiName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p><img src="/interview//native-sdk/%E9%80%9A%E4%BF%A11.png" alt="图1"> <img src="/interview//native-sdk/%E9%80%9A%E4%BF%A12.png" alt="通信2"></p> <h3 id="h5调用native"><a href="#h5调用native" class="header-anchor">#</a> h5调用native</h3> <p><img src="/interview//native-sdk/h5%E8%B0%83%E7%94%A8native.png" alt="h5调用native"></p> <h3 id="native调用h5"><a href="#native调用h5" class="header-anchor">#</a> native调用h5</h3> <p><img src="/interview//native-sdk/native%E8%B0%83%E7%94%A8h5.png" alt="native调用h5"></p> <h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h3> <p><a href="https://segmentfault.com/a/1190000025182935" target="_blank" rel="noopener noreferrer">JSBridge 实现原理解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="抓包"><a href="#抓包" class="header-anchor">#</a> 抓包</h3> <ol><li>charles</li> <li><a href="https://github.com/wuchangming/spy-debugger" target="_blank" rel="noopener noreferrer">spy-debugger<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://wproxy.org/whistle/questions.html" target="_blank" rel="noopener noreferrer">whistlejs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h3 id="cdn"><a href="#cdn" class="header-anchor">#</a> CDN</h3> <ul><li><a href="https://segmentfault.com/a/1190000039045541" target="_blank" rel="noopener noreferrer">cdn为什么快，原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.huaweicloud.com/zhishi/cdn001.html" target="_blank" rel="noopener noreferrer">cdn回源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="spa页面-和-多页面对比"><a href="#spa页面-和-多页面对比" class="header-anchor">#</a> spa页面 和 多页面对比</h3> <ul><li><p><a href="https://juejin.cn/post/6913436819115737102" target="_blank" rel="noopener noreferrer">spa和多页面的优势和缺点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
spa</p></li> <li><p>优点</p> <ol><li>切换的流畅度比较高</li> <li>前后端分离，利于维护</li> <li>减轻服务端压力</li> <li>跳转动画有优化的空间</li></ol></li> <li><p>缺点</p> <ol><li>seo不友好</li> <li>一次要加载所有资源（可使用路由懒加载）</li> <li>需要额外的管理路由（不能使用浏览器天然的前进后退）
<ul><li>这里需要去复习弄清楚 vue-router的原理</li></ul></li></ol></li></ul> <blockquote><p>mpa</p></blockquote> <ul><li>优点
<ol><li>seo友好</li> <li>首屏加载快</li></ol></li> <li>缺点
<ol><li>每次都需要去加载公告的资源（js, css, html，图片等）</li> <li>页面跳转没有跳转动画</li> <li>项目维护起来比较麻烦，重复的代码较大</li></ol></li></ul> <h4 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h4> <ul><li>可使用ssr方案解决</li></ul> <h2 id="项目介绍思路"><a href="#项目介绍思路" class="header-anchor">#</a> 项目介绍思路</h2> <h3 id="思路和角度"><a href="#思路和角度" class="header-anchor">#</a> 思路和角度</h3> <ul><li><p>业务相关</p> <ol><li>业务数据 tracker</li> <li>业务流程（业务理解）</li> <li>项目规划</li></ol></li> <li><p>技术相关</p> <ol><li><p>采集业务数据 tracker</p></li> <li><p>性能监控</p></li> <li><p>错误捕获 sentry</p></li> <li><p>错误监控</p> <ol><li>页面错误</li> <li>接口错误</li></ol></li> <li><p>代码质量</p> <ol><li>sonar</li> <li>ts</li> <li>elsint stylelint husky</li> <li>代码review</li></ol></li> <li><p>项目优化</p> <ol><li>首页优化</li> <li>打包优化 html, js, css
<ol><li>分包</li> <li>压缩</li> <li>tree shaking</li> <li>抽离css</li> <li>webpack 其他优化问题</li></ol></li> <li>开发（体验）阶段优化</li> <li>cdn</li> <li>ssr</li> <li>离线化</li></ol></li> <li><p>代码重构</p></li> <li><p>字体反爬</p></li> <li><p>native-sdk原理</p></li></ol></li></ul> <h3 id="项目亮点难点"><a href="#项目亮点难点" class="header-anchor">#</a> 项目亮点难点</h3> <ul><li>typescript</li> <li>sentry</li> <li>友商过户评分 用到zrender 绘制了评分雷达图</li> <li>重构
<ul><li><p>重构原因</p> <ul><li>项目各个列表 和 订单耦合度过大，添加新功能时改动过大</li> <li>向公司的ske-cli脚手架靠拢，统一开发模式</li> <li>引入typescript 代码的约束</li></ul></li> <li><p>重构的方案</p> <ul><li>创建新到的代码到src目录下，把久的项目放入old的目录下， 分别打包，把最后的dist包合并到一起</li> <li>新老页面跳转 replace的方式跳转（封装了跳转方法，过渡阶段需要使用）</li> <li>抽离公用组件</li> <li>抽离页面代码 解耦</li> <li>新老页面跳转 白屏问题</li> <li>加入单元测试</li></ul></li> <li><p>重构顺序和重构时机</p> <ul><li>制定了重构的计划： 列出步骤和方向</li> <li>把不流量小的页面首先抽离重构</li> <li>二级页面，或者三级页面重构</li> <li>抽离出一些公用的模块 button，头部，没网，没数据的组件，toast,dialog组件，或者native方法封装</li> <li>最后重构一级页面，和改动频繁的页面，建立新的测试分支</li> <li>每个模块的完事后的自测 开会codereview代码，测试环境的部署，稳定一段时间后，合分支准上线</li></ul></li> <li><p>遇到的问题</p> <ul><li>新老页面白屏问题（nginx配置缓存html）</li> <li>eslint冲突</li> <li>新旧页面的baseUrl不同，协调客户端进行强更</li> <li>兜底方案 nginx重定向，把旧的页面重定向到新的页面</li> <li>健康检查 url改变，导致健康检查过不去，更新部署包</li></ul></li> <li><p>重定向
保证没有强制更新的用户 能够用正常跳转到页面</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ /partners_app/brokerage-agency.html</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> /partners_app/brokerage-agency.html(.*) /partners_app/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">1/25/2022, 10:32:13 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/interview/projects/webpack/">
        webpack
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/interview/assets/js/app.3ba8eaa2.js" defer></script><script src="/interview/assets/js/2.7108d1be.js" defer></script><script src="/interview/assets/js/33.c75eaf5c.js" defer></script>
  </body>
</html>
